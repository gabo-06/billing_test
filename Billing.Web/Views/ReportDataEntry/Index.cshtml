<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">        
        <div class="col-lg-12" id="divCaso">
            <div class="ibox float-e-margins">
                <div class="ibox-title header_formulario">
                    <h5>DATA ENTRY REPORTS</h5>
                </div> 
                <div class="ibox-content">
                    <form method="get" class="form-horizontal" id="frmBusquedaCaso">
                        <div class="form-group text-center" style="margin-bottom: 0px;">
                            <label class="col-sm-4 control-label">Patient Last Name	</label>
                            <div class="col-sm-5">
                                <input type="text" class="form-control ui-autocomplete-input" id="txtBuscaCaso" autocomplete="off">                                
                            </div>
                        </div>
                    </form> 
                </div>              
                 
                <div class="ibox-content" id="EnvolturatblCasos" style="padding-bottom:6px;">
                    <div class="form-group">
                               <!--///////////////////LISTA///////////////////////-->
                             @Html.Partial("../ReportDataEntry/CasosParaBusquedaAvanzada")
                    </div>  
                </div> 
            </div>
        </div>  
    </div>
     
    <div class="row">        
        <div class="col-lg-12" id="divResultado">
            <div class="ibox float-e-margins">
                <div class="ibox-title header_formulario">
                    <h5>RESULTS</h5>
                </div> 
                <div class="ibox-content" id="div_reporte" style="border-style: none; border-width: 0;">
                    <div class="form-group">
                      <div class="row">
                        <form class="form-horizontal" method="get" role="form">
                            <input type="hidden" value="0" id="hdCodigoCaso">
                            <div  class="col-sm-6">
                                <div class="form-group">
                                    <label class="col-lg-3 control-label">Patient:</label> 
                                    <div class="col-lg-9">
                                        <input type="text" readonly="" id="txtPatient" class="form-control l-i-de">                                        
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-3 control-label">SSNumber:</label> 
                                    <div class="col-lg-9">
                                        <input type="text" readonly="" id="txtSSNumber" class="form-control l-i-de">                                        
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" id="hdCodigoPaciente">
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label class="col-lg-3 control-label">DOI:</label> 
                                    <div class="col-lg-9">
                                        <input type="text" readonly="" id="txtDOI" class="form-control l-i-de">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-3 control-label">Closing Date:</label> 
                                    <div class="col-lg-9">
                                        <input type="text" readonly="" id="txtClosingDate" class="form-control l-i-de">
                                    </div>
                                </div>

                            </div>

                        </form>
                    </div>

                    <div class="ibox-content text-center" style="padding-bottom:0px;margin:0 auto;width:30%;">     

                        <div style="float:left;margin-left:20px">
                     @using (Html.BeginForm("ExportToWordDataEntry", "ReportDataEntry", FormMethod.Post))
                    {     
                                <div class="form-group" style="padding-bottom:0px;">     
                                    <button id="btnGeneraWord" class="btn btn-primary" type="submit" data-toggle="tooltipB"   data-placement="top" title="" data-original-title="Create a New case">
                                       <i class="fa fa-save"></i>&nbsp; Export to Word</button>
                                    <input type="hidden"  id="CodigoCasoSeleccionadoWord" name="CodigoCasoSeleccionado"  value="0"/>      
                                    <input type="hidden"  id="Bih_codeWord" name="Bih_code"  value="0"/>     
                                    <input type="hidden"  id="pacienteW" name="paciente"  value="0"/>            
                                    <input type="hidden"  id="doiW" name="doi"  value="0"/>     
                                    <input type="hidden"  id="ssnumberW" name="ssnumber"  value="0"/>                      
                                    <input type="hidden"  id="closingDateW" name="closingDate"  value="0"/>   
                                </div>
                          
                    }</div>

                        <div style="float:left;margin-left:20px">
                   @using (Html.BeginForm("ExportToPdfDataEntry", "ReportDataEntry", FormMethod.Post))
                    {       
                                
                                 <div class="form-group" style="padding-bottom:0px;">     
                                    <button id="btnReportPdf" class="btn btn-primary" type="submit" data-toggle="tooltipB"   data-placement="top" title="" data-original-title="Create a New case">
                                        <i class="fa fa-save"></i>&nbsp; Export to Pdf
                                    </button>
                                    <input type="hidden"  id="CodigoCasoSeleccionadoPdf" name="CodigoCasoSeleccionado"  value="0"/>  
                                     <input type="hidden"  id="Bih_codePdf" name="Bih_code"  value="0"/>                                                                            
                                     <input type="hidden"  id="pacienteP" name="paciente"  value="0"/>   
                                     <input type="hidden"  id="doiP" name="doi"  value="0"/>   
                                     <input type="hidden"  id="ssnumberP" name="ssnumber"  value="0"/>   
                                     <input type="hidden"  id="closingDateP" name="closingDate"  value="0"/>   
                                                              
                                </div>  
                    }
                            </div>
                        <div style="clear:both">
                            </div>

                    </div> 

                            @* @Html.Partial("../ReportDataEntry/lista_reporte")*@
                        <div id ="resultadoReporte">
                        </div> 
                    </div>  
                </div> 
            </div>
        </div>  
    </div>



<!----------------------------------------------------------- MODAL ------------------------------------------------------->
<div class="modal inmodal" id="myModalDetalle" tabindex="-1" role="dialog"  aria-hidden="true">
                            <div class="modal-dialog">
                                    <div class="modal-content animated fadeIn">
                                        <div class="modal-header header_formulario" style="padding:2px;">
                                            <button type="button" class="close" data-dismiss="modal" style="margin-top: 4px;margin-right: 30px;opacity:1;color: white;"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                                            <!--<i class="fa fa-fa fa-warning modal-icon"></i>-->
                                            <h3 class="modal-title"> Detail </h3>
                                        </div>
                                        <!--<div class="ibox-title header_formulario" >  <h5>Add New Doctor</h5> </div>-->

                                    <!--<div class="modal-body">-->
                                          <div class="col-sm-12">
                                            @Html.Partial("../ReportDataEntry/billing_Formulario")
                                          </div> 
                                    <!--</div>-->
                                        <div class="modal-footer" style="text-align:center;">                                                                                        
                                            <button type="button" id="btnCancelarDoctorModal" class="btn btn-danger control_tabs" tabindex ="216"  data-dismiss="modal">Cancel</button>
                                        </div>
                                    </div>
                            </div>
</div>
<!-------------------------------------------------------- FIN MODAL ------------------------------------------------------->


</div>

@Html.Partial("footer")

<script> 
    var VecesSelecionaCaso = 0;

    $(Inicio);

    function Inicio()
    {
        // console.clear();

        // Actualiza la variable globlal "ProcesoActual" declarada en index.cshtml de MasterViewer con el nombre del proceso donde se está actualmente (Para los mantenedores se actualiza con una cadena vacía ya que no se requiere mostrar una advertencia cuando se abandona alguno de ellos).
        ProcesoActual = "Reports";



        $("#btnGuardarEntradas").attr("disabled", true); // InHabilita el botón registrar.

        $("#txtBuscaCaso").focus();

        // Cuando se presiona TAB el botón para seleccionar un caso obtiene el foco (Temporal).
        $("#txtBuscaCaso").on("keydown", function (e)
        {
            if (e.keyCode == 13)
            {
                e.preventDefault();
                return false;
            }

            if (e.keyCode == 9)
            {
                e.preventDefault();
                $(".SeleccionarCaso").focus();
            }
        });

        // ******************************************************************************************************************

        // Cuando se busca un caso, se van mostrando los resultados en la tabla de casos.
        $("#txtBuscaCaso").on("keyup", BuscaCaso);
        $(".SeleccionarCaso").on("click", SeleccionarCasoReporte);
//        $(".SeleccionarDetalleCaso").on("click", MostrarDetalleFacturas);
        $("#tblCasos > tbody").on("click", "tr > td > .SeleccionarCaso", SeleccionarCasoReporte);

        /* Eliminar controles innecesarios de la tabla de controles */
        $("#tblControlesDataEntry_length").css({ "display": "none" });
        $("#tblControlesDataEntry_info").css({ "display": "none" });
        $("#tblControlesDataEntry_filter").css({ "display": "none" });

        
    }



    function SeleccionarCasoReporte(e)
    {
        e.preventDefault();
        
        var control = $(this);

        CodigoCasoSeleccionado = control.parent().parent().find("td:eq(0)").html();
  
        nombrePaciente = control.parent().parent().find("td:eq(1)").html();
        apellidoPaciente = control.parent().parent().find("td:eq(2)").html();
        ssNUmber = control.parent().parent().find("td:eq(3)").html();
        DOI = control.parent().parent().find("td:eq(4)").html();
        closingDate = control.parent().parent().find("td:eq(5)").html();

        $("#Bih_codeWord").val(0);
        $("#Bih_codePdf").val(0);
   
        console.log(apellidoPaciente); console.log(nombrePaciente);
        paciente = nombrePaciente + " " +apellidoPaciente;

        cargaInformacionFormulario(CodigoCasoSeleccionado, paciente, DOI, ssNUmber, closingDate);
        CodigoBillingSeleccionado = 0;
        cargaInformacionLista(CodigoCasoSeleccionado, CodigoBillingSeleccionado);
        ancla();
    }

    function cargaInformacionFormulario(CodigoCasoSeleccionado,paciente, DOI, ssNUmber, closingDate)
    {
        $("#txtPatient").val(paciente);
        $("#txtSSNumber").val(ssNUmber);
        $("#txtDOI").val(DOI);
        $("#txtClosingDate").val(closingDate);

        //////////////////////////////
        $("input[name=CodigoCasoSeleccionado]").val(CodigoCasoSeleccionado);        
        $("input[name=closingDate]").val(closingDate);
        $("input[name=paciente]").val(paciente);
        $("input[name=doi]").val(DOI);
        $("input[name=ssnumber]").val(ssNUmber);

    }
    function cargaInformacionLista(CodigoCasoSeleccionado, CodigoBillingSeleccionado) {
       
        $.ajax({
            type: "GET",
            data: { CodigoCasoSeleccionado: CodigoCasoSeleccionado, Bih_code: CodigoBillingSeleccionado },
            url: '@Url.Action("listaDataEntry", "ReportDataEntry")',
            contentType: 'application/html;charset=utf-8',
            dataType: 'html',
            success: function (Data) {
                $("#resultadoReporte").html(Data);
            }
         });

    }
    function ancla() {
        $("html,body").stop().animate({ scrollTop: $("#div_reporte").offset().top }, 1000);
    }


    function llenaTipo(tipo)
    {
        $("#tipo").val(tipo);
    }
    function BuscaCaso(e)
    {
        $('#tblCasos').dataTable().fnFilter($("#txtBuscaCaso").val());

        if ($(this).val().trim() == "")//oculta tabla
        {
            $("#tblCasos > tbody").css({ "display": "none" });
            $("#tblCasos_paginate").css({ "display": "none" });
        }
        else
        {
            $("#tblCasos > tbody").css({ "display": "table-row-group" });
            $("#tblCasos_paginate").css({ "display": "block" });
        }
    }



    function ObtenerDatosPaciente(CodigoPaciente)
    {
        var Paciente;

        $.ajax({
            type: "POST",
            async: false,
            data: JSON.stringify({ "Codigo": parseInt(CodigoPaciente) }),
            url: '@Url.Action("Buscar", "Patient")',
                contentType: "application/json",
                dataType: 'json',
                success: function (DatosPaciente)
                {
                    Paciente = DatosPaciente;
                }
        });

        return Paciente;
    }


    function MensajeError(mensaje, error)
    {
        swal({
            title: error,
            text: mensaje
        });
    }
</script>